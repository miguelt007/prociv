<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ocorr√™ncias GeoJSON Dashboard</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #0f172a;
    color: white;
}
header {
    padding: 20px;
    text-align: center;
    font-size: 24px;
}
.container {
    padding: 20px;
}
.cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}
.card {
    background: #1e293b;
    padding: 20px;
    border-radius: 12px;
    text-align: center;
}
.card h2 {
    margin: 0;
    font-size: 28px;
    color: #38bdf8;
}
table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 30px;
}
th, td {
    padding: 10px;
    text-align: left;
}
th {
    background: #1e293b;
}
tr:nth-child(even) {
    background: #1e293b;
}
#map {
    height: 400px;
    border-radius: 12px;
}
</style>
</head>
<body>

<header>üìç Ocorr√™ncias - Mapa e Dados</header>

<div class="container">
    <div class="cards">
        <div class="card">
            <p>Total Ocorr√™ncias</p>
            <h2 id="totalCount">0</h2>
        </div>
        <div class="card">
            <p>Latitude M√©dia</p>
            <h2 id="avgLat">0</h2>
        </div>
        <div class="card">
            <p>Longitude M√©dia</p>
            <h2 id="avgLon">0</h2>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Atributos (exemplo)</th>
                <th>Longitude</th>
                <th>Latitude</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>

    <div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const map = L.map('map').setView([39.5, -8.0], 6);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

async function fetchGeoData() {
    const url =
        "https://services-eu1.arcgis.com/VlrHb7fn5ewYhX6y/arcgis/rest/services/OcorrenciasSite/FeatureServer/0/query?" +
        "where=0%3D0&outFields=*&f=geojson";

    try {
        const res = await fetch(url);
        const data = await res.json();

        const features = data.features || [];

        document.getElementById('totalCount').innerText = features.length;

        let sumLat = 0;
        let sumLon = 0;

        const table = document.getElementById('tableBody');
        table.innerHTML = "";

        features.forEach((f, i) => {
            const coords = f.geometry.coordinates;
            const lon = coords[0];
            const lat = coords[1];

            sumLat += lat;
            sumLon += lon;

            // Table linha
            table.innerHTML += `
                <tr>
                    <td>${i+1}</td>
                    <td>${JSON.stringify(f.properties)}</td>
                    <td>${lon.toFixed(4)}</td>
                    <td>${lat.toFixed(4)}</td>
                </tr>
            `;

            // Map marker
            L.marker([lat, lon])
                .addTo(map)
                .bindPopup("ID: " + (i+1));
        });

        if (features.length > 0) {
            document.getElementById('avgLat').innerText = (sumLat / features.length).toFixed(4);
            document.getElementById('avgLon').innerText = (sumLon / features.length).toFixed(4);
        }
    } catch (err) {
        console.error("Erro ao carregar dados:", err);
    }
}

fetchGeoData();
</script>

</body>
</html>
